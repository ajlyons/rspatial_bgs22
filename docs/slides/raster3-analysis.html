<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Raster Analyses  " />
  <meta name="copyright" content="<span class='footer-right'><a href='../acknowledgements.html'>Acknowledgements</a></span><span class='footer-right'><a href=' https://etherpad.wikimedia.org/p/rspatial-bgs22 ' target='_blank'>Forum</a></span><span class='footer-right'><a href=' https://ajlyons.github.io/rspatial_bgs22 '> https://ajlyons.github.io/rspatial_bgs22 </a></span><span class='footer-right'><a href='../index.html'>Home</a></span><span class='footer-subtitle'> Spatial Data Analysis with R </span>"/>
  <meta name="font-size-adjustment" content="2"/>
  <title>Spatial Data Analysis with R  BayGeo, Spring 2022</title>
  <style type="text/css">
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
            pre > code.sourceCode { white-space: pre; position: relative; }
            pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
            pre > code.sourceCode > span:empty { height: 1.2em; }
            .sourceCode { overflow: visible; }
            code.sourceCode > span { color: inherit; text-decoration: inherit; }
            div.sourceCode { margin: 1em 0; }
            pre.sourceCode { margin: 0; }
            @media screen {
            div.sourceCode { overflow: auto; }
            }
            @media print {
            pre > code.sourceCode { white-space: pre-wrap; }
            pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
            }
            pre.numberSource code
              { counter-reset: source-line 0; }
            pre.numberSource code > span
              { position: relative; left: -4em; counter-increment: source-line; }
            pre.numberSource code > span > a:first-child::before
              { content: counter(source-line);
                position: relative; left: -1em; text-align: right; vertical-align: baseline;
                border: none; display: inline-block;
                -webkit-touch-callout: none; -webkit-user-select: none;
                -khtml-user-select: none; -moz-user-select: none;
                -ms-user-select: none; user-select: none;
                padding: 0 4px; width: 4em;
                color: #aaaaaa;
              }
            pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
            div.sourceCode
              {   }
            @media screen {
            pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
            }
            code span.al { color: #ff0000; font-weight: bold; } /* Alert */
            code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
            code span.at { color: #7d9029; } /* Attribute */
            code span.bn { color: #40a070; } /* BaseN */
            code span.bu { } /* BuiltIn */
            code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
            code span.ch { color: #4070a0; } /* Char */
            code span.cn { color: #880000; } /* Constant */
            code span.co { color: #60a0b0; font-style: italic; } /* Comment */
            code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
            code span.do { color: #ba2121; font-style: italic; } /* Documentation */
            code span.dt { color: #902000; } /* DataType */
            code span.dv { color: #40a070; } /* DecVal */
            code span.er { color: #ff0000; font-weight: bold; } /* Error */
            code span.ex { } /* Extension */
            code span.fl { color: #40a070; } /* Float */
            code span.fu { color: #06287e; } /* Function */
            code span.im { } /* Import */
            code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
            code span.kw { color: #007020; font-weight: bold; } /* Keyword */
            code span.op { color: #666666; } /* Operator */
            code span.ot { color: #007020; } /* Other */
            code span.pp { color: #bc7a00; } /* Preprocessor */
            code span.sc { color: #4070a0; } /* SpecialChar */
            code span.ss { color: #bb6688; } /* SpecialString */
            code span.st { color: #4070a0; } /* String */
            code span.va { color: #19177c; } /* Variable */
            code span.vs { color: #4070a0; } /* VerbatimString */
            code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
          </style>
  <style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACkUlEQVQ4jX2SW0jTcRTHTzNyeZlh6lqmm3POdNPC6SxSEzaqafkykOFoIxTDWpKRFV6iQMNLFyMSsQvUW0WORc2WWBmGKEGZXUyz0NrmNmfa1PYgfHsQ1v5oHjgvX875/M45vy/R8mDJ9caxrFIL5CUWJB00Q9n+7Q+l1BetUMuMTL3JpTB0QVnejd1Hu9DQ60G5eQbqB7PIvj0L2bUZ0KZzghWbs0o7Fx3Tc/B6vStm6+g0wrQvIKh2gKKyUxnNSZoO685SC1YDeL1e9Ll+Ia7WCd5pJ4hojQ8g1nViezETYBqZx93BOdwa9jAgsdUT4J6ZQqC6f4GIiLYU9/RzNWYIdU9hd/8rLjN7UGT8DbWROVVMlQsBBWas142DiIikdfbFMF0POIVm2NzM1zwLS+mvcSsnEajpBSv/8RIgucGJ1EYXEs+NwjrlWfUGMee/Y2PFJIJLrFibex8kOsahhCYnUlpnIL1kh9X9/yMKG2yIOOlAsPYnAveZsE75EEQUQLwTwy5Rsxvx9UxApKEPEYY+BiSizA623oaggkdgq4xLKwRLq7i8sy6EFlpg8wNEVwyAd3wAbZ8cPu3CazeCC/sRojYjaL8Jvm8MPWLDBm03A8CveQ9+7RBia4cYU4QfeokwzTOwc6/4OzKXHap/C5ufD0RNo0i4OAZR81dcnnD69Mp3PxBe9GRkuZdFKk7sqTcQ132EpGUMydetSLnpgOSGHVtbxpHU9AX8mkFEG55/ZrjQL1h82V6esPLVh8Sr40i940J6xzzS7s1C0m6HqHEEiTnatgT5gcPijHxltFwhjpRIQpZjBAJ2lFTBFW5TiOPT8mXx6apdcRl5OaJM1Q6hLC9ls3RPTLgok0NELCKiv02kPqt/O1MZAAAAAElFTkSuQmCC" rel="icon" type="image/x-icon" />
  <meta name="robots" content="noindex,nofollow"/>
  <script language="javascript" type="text/javascript">
  function TriShowHide(shID) {
    shIDspan = shID + "span";
    shIDdiv = shID + "div";
    if (document.getElementById(shIDdiv).style.display != 'block') {
      document.getElementById(shIDdiv).style.display = 'block';
      txtSpan = "&#9660;";
    } else {
      document.getElementById(shIDdiv).style.display = 'none';
      txtSpan = "&#9654;";
    }
    document.getElementById(shIDspan).innerHTML = txtSpan + " ";
  }
  function showHide(shID) {
    if (shID=="soln-show-all") {
      var allAnswerCode = document.getElementsByClassName("answer-code");
      for (i = 0; i < allAnswerCode.length; i++) {
          allAnswerCode[i].style.display = 'block';
      }
    } else if (shID=="soln-hide-all") {
      var allAnswerCode = document.getElementsByClassName("answer-code");
      for (i = 0; i < allAnswerCode.length; i++) {
          allAnswerCode[i].style.display = 'none';
      }
    } else if (shID=="hints-show-all") {
      var allAnswerCode = document.getElementsByClassName("hint");
      for (i = 0; i < allAnswerCode.length; i++) {
          allAnswerCode[i].style.display = 'block';
      }
    } else if (shID=="hints-hide-all") {
      var allAnswerCode = document.getElementsByClassName("hint");
      for (i = 0; i < allAnswerCode.length; i++) {
          allAnswerCode[i].style.display = 'none';
      }
    } else {
      if (document.getElementById(shID)) {
        if (document.getElementById(shID).style.display != 'block') {
          document.getElementById(shID).style.display = 'block';
        } else {
          document.getElementById(shID).style.display = 'none';
        }
      }
    }
  }
  function CopyToClipboard(containerid) {
  if (document.selection) {
      var range = document.body.createTextRange();
      range.moveToElementText(document.getElementById(containerid));
      range.select().createTextRange();
      document.execCommand("copy");
  } else if (window.getSelection) {
      var range = document.createRange();
      range.selectNode(document.getElementById(containerid));
      window.getSelection().addRange(range);
      document.execCommand("copy");
      // alert("text copied")
  }}
  </script>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-163964617-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-163964617-1');
  </script>
  <script src="lib/header-attrs-2.13/header-attrs.js"></script>
  <link href="lib/slidy-2/styles/slidy.css" rel="stylesheet" />
  <script src="lib/slidy-2/scripts/slidy.js"></script>
  <script src="lib/slidy_shiny-1/slidy_shiny.js"></script>
  <script src="lib/clipboard-1.7.1/clipboard.min.js"></script>
  <link href="lib/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
  <link href="lib/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
  <script src="lib/klippy-0.0.0.9500/js/klippy.min.js"></script>
  <script src="lib/kePrint-0.0.1/kePrint.js"></script>
  <link href="lib/lightable-0.0.1/lightable.css" rel="stylesheet" />
  <link rel="stylesheet" type="text/css" media="screen, projection, print"
   href="../css/slidy_styles.css" />
  <meta name="duration" content="0" />
</head>
<body>
<script type="text/javascript">w3c_slidy.mouse_click_enabled = false;</script>
<div class="slide titlepage">
  <h1 class="title"><span class="course-title">Spatial Data Analysis with R </span><br/><span class="course-subtitle">BayGeo, Spring 2022</span></h1>
  <p class="author">
Raster Analyses <br/><img src='images/map-algebra256_250x220.png'/>
  </p>
</div>
<div id="raster-analyses" class="slide section level1">
<h1>Raster Analyses</h1>
<script>
  addKlippy('left', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<p>Common analytical opertations for rasters include:</p>
<table class="tbl_compact">
<thead>
<tr>
<th style="text-align:left;">
Task
</th>
<th style="text-align:left;">
Function(s)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
descriptive cell statistics
</td>
<td style="text-align:left;font-family: monospace;">
cellStats()
</td>
</tr>
<tr>
<td style="text-align:left;">
binary mask
</td>
<td style="text-align:left;font-family: monospace;">
myraster[]
</td>
</tr>
<tr>
<td style="text-align:left;">
raster algebra (local operations)
</td>
<td style="text-align:left;font-family: monospace;">
* + - /
</td>
</tr>
<tr>
<td style="text-align:left;">
focal (neighborhood) operations
</td>
<td style="text-align:left;font-family: monospace;">
focal()
</td>
</tr>
<tr>
<td style="text-align:left;">
zonal stats
</td>
<td style="text-align:left;font-family: monospace;">
zonal()
</td>
</tr>
<tr>
<td style="text-align:left;">
distance surface
</td>
<td style="text-align:left;font-family: monospace;">
distance()
</td>
</tr>
<tr>
<td style="text-align:left;">
spatial join (enrichment)
</td>
<td style="text-align:left;font-family: monospace;">
extract()
</td>
</tr>
<tr>
<td style="text-align:left;">
spatial interpolation
</td>
<td style="text-align:left;font-family: monospace;">
</td>
</tr>
<tr>
<td style="text-align:left;">
classify pixels
</td>
<td style="text-align:left;font-family: monospace;">
</td>
</tr>
<tr>
<td style="text-align:left;">
time series analysis
</td>
<td style="text-align:left;font-family: monospace;">
</td>
</tr>
</tbody>
</table>
</div>
<div id="global-zonal-focal-and-local-operations" class="slide section level1">
<h1>Global, Zonal, Focal, and Local Operations</h1>
<p>Mathematical operations on raster cells are generally divided into <em>local</em>, <em>focal</em>, <em>zonal</em>, and <em>global</em>, in reference to their <strong><em>spatial scope</em></strong> (Tomlin 1990).</p>
<p><img src="images/local-focal-zonal-global_930x274.png" class="indented2" /></p>
<h2 id="global-stats">Global Stats</h2>
<p>To view descriptive statistics about cell values for an entire layer(s), we can use the <tt>summary()</tt> function or <tt>cellStats()</tt>.</p>
<div class="indented2">
<p><tt>cellStats(<em>x</em>, <em>stat</em>=‘mean’, …) </tt></p>
</div>
<p><em>x</em> should be a raster and <em>stat</em> the name of a function.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cellStats</span>(sfpen_elev, <span class="at">stat=</span><span class="st">&#39;mean&#39;</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cellStats</span>(sfpen_elev, <span class="at">stat=</span><span class="st">&#39;sd&#39;</span>)</span></code></pre></div>
<div class="tryit">
<p>Find the mean elevation for San Francisco.</p>
<p><span id="soln_okcoon" class="showhidesoln" onclick="showHide(&#39;okcoon&#39;);return false;">[Solution]</span></p>
<div id="okcoon" class="hint">
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cellStats</span>(sfcity_msk_dem, <span class="at">stat=</span><span class="st">&#39;mean&#39;</span>)</span></code></pre></div>
</div>
</div>
<h2 id="zonal-stats">Zonal Stats</h2>
<p>Zonal stats compute statistics for discrete areas within a raster. To compute zonal statsistics use the <tt>zonal()</tt> function:</p>
<div class="indented2">
<p><tt>zonal(<em>x</em>, <em>z</em>, fun=‘mean’, …) </tt></p>
</div>
<p><em>x</em> should be a raster, and <em>z</em> should a categorical raster where the cell values are integers representing different zones. Both rasters should have the same extent, rows, columns, and CRS.</p>
<h3 id="example-zonal-stats">Example: Zonal Stats</h3>
<p>Let’s find the average elevation per neighborhood in San Francisco.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>nb_elev_df <span class="ot">&lt;-</span> <span class="fu">zonal</span>(sfcity_msk_dem, sfnb_rst, <span class="at">fun=</span><span class="st">&quot;mean&quot;</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>nb_elev_df</span></code></pre></div>
<div class="tryit">
<p>What is the average slope per SF neighborhood?</p>
<div id="dpfyss" class="hint">
<p>To remember how to compute the slope, see <a href="part04b_raster-pt1.html#slope-aspect-and-hill-shade">Finding the Slope, Aspect, and Hillshade</a></p>
</div>
</div>
<div class="tip">
<p>You can also get zonal statistics using the <tt>extract()</tt> function with a <tt>SpatialPolygons</tt> object.</p>
</div>
<h2 id="focal-stats">Focal Stats</h2>
<p>To compute focal stats, th go-to function is:</p>
<div class="indented2">
<p><tt>focal(<em>x</em>, <em>w</em>, <em>fun</em>, …)</tt></p>
</div>
<p>Where <em>x</em> is a raster, <em>w</em> is a matrix of weights (the moving window), and <em>fun</em> is a function.</p>
<p>Examples: See <a href="https://en.wikipedia.org/wiki/Kernel_(image_processing)" target="_blank">Image Processing with Kernels</a></p>
</div>
<div id="create-a-distance-surface" class="slide section level1">
<h1>Create a Distance Surface</h1>
<p>The <tt>distance()</tt> function will generate a new raster whose cell values represent the distance to the nearest feature.</p>
<div class="indented2">
<tt>distance(<em>x</em>, <em>y</em>, …)</tt>
</div>
<p>This function returns different types of distance surfaces depending on what type of objects <em>x</em> and <em>y</em> are. Read the help page for details.</p>
<h2 id="example-distance-to-nearest-library-in-san-francisco">Example: Distance to Nearest Library in San Francisco</h2>
<p>To compute the distance to the nearest library, we need to rasterize the libraries using whichever raster we prefer as the ‘template’. Since we don’t care which library is closest, all cells that have a library will get value 1, and everything else will be NA.</p>
<p>Begin by importing a CSV file with the library locations. For details how we got the coordinates for each library, see <a href="part05d_geocoding.html">Geocoding</a>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>csv_fn <span class="ot">&lt;-</span> <span class="st">&quot;../docs/data/sf_libraries_latlon.csv&quot;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">file.exists</span>(csv_fn)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>sflib_loc_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(csv_fn, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sflib_loc_df)</span></code></pre></div>
<p>Next we convert this to a SpatialPoints object, and project to UTM Zone 10.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>sflib_ll <span class="ot">&lt;-</span> sp<span class="sc">::</span><span class="fu">SpatialPoints</span>(<span class="at">coords=</span>sflib_loc_df[, <span class="fu">c</span>(<span class="st">&quot;lon&quot;</span>,<span class="st">&quot;lat&quot;</span>)], <span class="at">proj4string =</span> <span class="fu">CRS</span>(<span class="st">&quot;+init=epsg:4326&quot;</span>))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>utm10n <span class="ot">&lt;-</span> sp<span class="sc">::</span><span class="fu">CRS</span>(<span class="st">&quot;+proj=utm +zone=10 +ellps=WGS84&quot;</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>sflib_utm <span class="ot">&lt;-</span> sp<span class="sc">::</span><span class="fu">spTransform</span>(sflib_ll, utm10n)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sflib_utm, <span class="at">axes=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>Time to rasterize. We pass <tt>field=1</tt> so cells with a feature in them will be assigned the value 1.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>sflib_rst <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">rasterize</span>(sflib_utm, sfcity_msk_dem, <span class="at">field=</span><span class="dv">1</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">freq</span>(sflib_rst)</span></code></pre></div>
<p>Finally we’re ready to create the distance surface.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>sf_dist2lib_rst <span class="ot">&lt;-</span> <span class="fu">distance</span>(sflib_rst)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sf_dist2lib_rst)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sflib_utm, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">cex=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="tryit">
<p>Compute the distance to the nearest library in San Francisco.</p>
<p>Bonus: compute the average distance to library for each neighborhood. Which neighborhood has the best library coverage as measured by distance?</p>
</div>
</div>
<div id="binary-masks" class="slide section level1">
<h1>Binary Masks</h1>
<p>Binary masks are rasters where the cell values are either <tt>1</tt> or <tt>0</tt> (or NA). A value of <tt>1</tt> generally means the cell satisfies some condition, for example suitable habitat or an object of interest was seen there. <tt>0</tt> or <tt>NA</tt> means the condition was not met. Binary masks are useful in analysis because they reduce a lot of data down to just two categories, and they’re easy to combine through raster algebra (below).</p>
<p>Binary masks can be generated with the same techniques used to <a href="part04c_raster-pt2.html#(11)">rescale and reclassify</a> rasters. A standard technique consists of three steps:</p>
<ol style="list-style-type: decimal">
<li><p>Write an expression that returns TRUE or FALSE if cell values meet the condition.</p></li>
<li><p>Create a new ‘blank’ raster for the mask, using an existing raster with the data as the template.</p></li>
<li><p>Use the expression as a filter for the mask raster, and assign a value of <tt>1</tt> to all cells that meet the condition.</p></li>
</ol>
<h2 id="example-binary-mask-of-high-slope-areas">Example: Binary Mask of High Slope Areas</h2>
<p>In this example, we’ll find all the areas in San Fransisco where the slope is greater than 20 degrees. These areas might be more susceptible to landslides, for example.</p>
<p><strong>Step 1: Compute the Slope Surface</strong></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>sfmsk_slope <span class="ot">&lt;-</span> <span class="fu">terrain</span>(sfcity_msk_dem, <span class="at">opt=</span><span class="st">&quot;slope&quot;</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sfmsk_slope)</span></code></pre></div>
<p><strong>Step 2: Write an expression that identifies cells whose slope is greater than 20 degrees</strong></p>
<p>Here we need to remember that slope units are radians, so we have to divide 20 degrees by 180 to get the minimum slope value in radians.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">getValues</span>(sfmsk_slope) <span class="sc">&gt;</span> <span class="dv">20</span><span class="sc">/</span><span class="dv">180</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(x)</span></code></pre></div>
<p><strong>Step 3: Next, we’ll use this raster as the ‘template’ for a new mask.</strong></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>sfmsk_steep <span class="ot">&lt;-</span> <span class="fu">raster</span>(sfmsk_slope)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hasValues</span>(sfmsk_steep)</span></code></pre></div>
<p>Currently, our mask has no values, however it has the same extent, # rows and columns, and CRS as the slope raster.</p>
<p><strong>Step 4: Use the expression as a filter and assign those cells the value of <tt>1</tt></strong></p>
<p>Finally, we use that expression as a filter for the mask raster, putting it inside square brackets, and give those cell a value of <tt>1</tt>. Even though the expression checks cell values from the slope raster, it works as a filter on the mask because the mask raster has the exact same number of rows, columns, extent, and CRS.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>sfmsk_steep[ <span class="fu">getValues</span>(sfmsk_slope) <span class="sc">&gt;</span> <span class="dv">20</span><span class="sc">/</span><span class="dv">180</span> ] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sfmsk_steep, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">legend=</span><span class="cn">FALSE</span>)</span></code></pre></div>
</div>
<div id="raster-algebra" class="slide section level1">
<h1>Raster Algebra</h1>
<p>Raster algebra (<em>aka</em> raster calculator, map algebra) is where you add, subtract, multiply, etc. two or more rasters together, as though they were numbers. The operation is evaluated pixel-by-pixel. Other things to remember when performing raster algebra:</p>
<div class="indented2">
<ul>
<li>The rasters should have the same extent, pixel size, and CRS<br />
</li>
<li>Generally all math operations (<tt>+ - * /</tt>) with a <tt>NA</tt> value will return <tt>NA</tt></li>
</ul>
</div>
<p>Raster algebra is used in many, many analyses. It’s particularly useful with binary masks, as it gives you many options to combine separate criteria (e.g., binary or ranked, apply weights, etc).</p>
<p><em>Syntax</em>: <tt>rast1 + rast2 - rast3 * rast4 / rast5</tt></p>
<h2 id="multiple-criteria-analaysis">Multiple Criteria Analaysis</h2>
<p>See the list of raster algebra functions sect 4 of the vignette</p>
<p><em>Notes</em></p>
<p>In this example, we multiplied the two masks together because the rules specified that <em>both</em> conditions were required. An alternative approach could be to <em>add</em> raster masks together so that the pixel values in the output reflect a ranking based on the number of criteria satisfied.</p>
<p>For large datasets and/or more complex combinations, the <em>overlay()</em> function may have better performance.</p>
<h2 id="example-identify-steep-slopes-in-yosemite">Example: identify steep slopes in Yosemite</h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>yosem_slope <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="st">&quot;~/yosemite_slope.tif&quot;</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>all_slope_vals <span class="ot">&lt;-</span> <span class="fu">getValues</span>(yosem_slope)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Slope is computed in radians. To show degrees, multiply by 180.</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(all_slope_vals <span class="sc">*</span> <span class="dv">180</span>, <span class="at">xlab=</span><span class="st">&quot;slope (degrees)&quot;</span>, <span class="at">col=</span><span class="st">&quot;grey80&quot;</span>, <span class="at">main=</span><span class="st">&quot;Yosemite Slope Distribution&quot;</span>)</span></code></pre></div>
<p>Let’s make a mask of high slope values, where we define steep slopes as &gt; 40 degrees.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Create a blank copy of yosem_slope</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>yosem_slope_steep <span class="ot">&lt;-</span> <span class="fu">raster</span>(yosem_slope)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hasValues</span>(yosem_slope_steep)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>threshhold_deg <span class="ot">&lt;-</span> <span class="dv">40</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>yosem_slope_steep[yosem_slope <span class="sc">&gt;</span> (threshhold_deg <span class="sc">/</span> <span class="dv">180</span>)] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>yosem_slope_steep</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(yosem_slope_steep)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yosem_slope)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yosem_slope_steep, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">legend=</span><span class="cn">FALSE</span>)</span></code></pre></div>
</div>
<div id="notebook-time" class="slide section level1">
<h1>Notebook Time!</h1>
<p><p><a href='https://raw.githubusercontent.com/ajlyons/rspatial_bgs22/main/docs/notebooks/nb_cmpgrnd_site.Rmd' target='_blank'>nb_cmpgrnd_site.Rmd</a></p> <div class='nb_desc'>Site a new campground using multi-criteria overlay analysis</div> <p style='font-size:80%;'><a href='https://ajlyons.github.io/rspatial_bgs22/notebooks/nb_cmpgrnd_site.nb.html' target='_blank' rel='noopener' style='color:#8993d3;'>preview notebook</a> | <a href='https://ajlyons.github.io/rspatial_bgs22/notebooks/nb_cmpgrnd_site_ans.nb.html' target='_blank' style='color:#8993d3;'>answer key</a></p></p>
<p><p><a href='https://raw.githubusercontent.com/ajlyons/rspatial_bgs22/main/docs/notebooks/nb_zonal_stats.Rmd' target='_blank'>nb_zonal_stats.Rmd</a></p> <div class='nb_desc'>Compute Watershed stats</div> <p style='font-size:80%;'><a href='https://ajlyons.github.io/rspatial_bgs22/notebooks/nb_zonal_stats.nb.html' target='_blank' rel='noopener' style='color:#8993d3;'>preview notebook</a> | <a href='https://ajlyons.github.io/rspatial_bgs22/notebooks/nb_zonal_stats_ans.nb.html' target='_blank' style='color:#8993d3;'>answer key</a></p></p>
</div>
<div id="extract-pixel-values" class="slide section level1">
<h1>Extract Pixel Values</h1>
<p>Raster mini exercise: construct an elevation profile along a bearing through the center of the park</p>
<p>Try It: change the bearing</p>
<p>Challenge: construct a profile for a trail - give them example code or a forum link on</p>
<p>Create some sample points</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>bbox <span class="ot">&lt;-</span> yosem_bnd_prj<span class="sc">@</span>bbox</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>num_pts <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">min=</span>bbox[<span class="dv">1</span>,<span class="dv">1</span>], <span class="at">max=</span>bbox[<span class="dv">1</span>,<span class="dv">2</span>], num_pts)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">min=</span>bbox[<span class="dv">2</span>,<span class="dv">1</span>], <span class="at">max=</span>bbox[<span class="dv">2</span>,<span class="dv">2</span>], num_pts)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>yosem_pts <span class="ot">&lt;-</span> <span class="fu">SpatialPoints</span>(<span class="at">coords=</span><span class="fu">data.frame</span>(<span class="at">x=</span>x,<span class="at">y=</span>y), <span class="at">proj4string =</span> yosem_bnd_prj<span class="sc">@</span>proj4string)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yosem_bnd_prj, <span class="at">axes=</span>T, <span class="at">asp=</span><span class="dv">1</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yosem_pts, <span class="at">cex=</span><span class="dv">2</span>, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>To extract values from a raster for where features overlap, use <tt>extract()</tt>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yosem_msk_dem_prj)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yosem_pts, <span class="at">cex=</span><span class="dv">2</span>, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>pt_elev <span class="ot">&lt;-</span> <span class="fu">extract</span>(yosem_msk_dem_prj, yosem_pts)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>pt_elev</span></code></pre></div>
</div>
<div id="additional-resources" class="slide section level1">
<h1>Additional Resources</h1>
<div class="indented1">
<p><a href="https://rspatial.org/spatial/8-rastermanip.html" target="_blank">Raster data manipulation</a>, book chapter by Robert Hijmans</p>
<p><a href="https://www.neonscience.org/raster-time-series" target="_blank">Working With Raster Time Series Data in R</a>, NEON Science</p>
<p><a href="https://earthdatascience.org/courses/earth-analytics/multispectral-remote-sensing-data/naip-imagery-raster-stacks-in-r/" target="_blank"><em>How to Open and Work With Multispectral Imagery in R</em></a></p>
</div>
</div>

  <!-- dynamically load mathjax for compatibility with self-contained -->
  <script>
    (function () {
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
      document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>

</body>
</html>
